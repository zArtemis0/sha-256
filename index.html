<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SHA-256 Miner + Stable Stats</title>
<style>
body { font-family: monospace; background: #111; color: #0f0; }
h1 { color: #0ff; }
p { margin: 5px 0; }
#stats { margin-top: 20px; }
</style>
</head>
<body>

<h1>SHA-256 Miner + Stable Stats</h1>

<div id="mining">
<p>Generation: <span id="generation">0</span></p>
<p>Current Input: <span id="currentInput">—</span></p>
<p>Current Hash: <span id="currentHash">—</span></p>
<p>Lowest Hash: <span id="lowestHash">—</span></p>
<p>Lowest Input: <span id="lowestInput">—</span></p>
</div>

<div id="stats">
<h2>System Stats (approx)</h2>
<p>CPU Cores: <span id="cpuCores">—</span></p>
<p>CPU Usage: <span id="cpuUsage">—</span></p>
<p>GPU Activity: <span id="gpuUsage">—</span></p>
<p>RAM Used: <span id="ramUsed">—</span> MB</p>
<p>Estimated Power: <span id="power">—</span> W</p>
</div>

<script>
/*********** Utils ***********/
function toHex(buffer) {
    return [...new Uint8Array(buffer)]
        .map(b => b.toString(16).padStart(2,'0'))
        .join('');
}

function incrementString(str) {
    let arr = str.split('');
    let i = arr.length - 1;
    while (i >= 0) {
        if (arr[i] === 'z') {
            arr[i] = 'a';
            if (i === 0) arr.unshift('a');
            i--;
        } else {
            arr[i] = String.fromCharCode(arr[i].charCodeAt(0)+1);
            break;
        }
    }
    return arr.join('');
}

/*********** Mining Variables ***********/
const chars = '0123456789abcdefghijklmnopqrstuvwxyz';
let currentInput = 'a';
let generation = 0;
let lowestHash = null;
let lowestInput = null;

/*********** System Stats ***********/
const cpuCores = navigator.hardwareConcurrency || 4;
document.getElementById('cpuCores').textContent = cpuCores;

let lastGen = 0;
let lastTime = performance.now();
let smoothedHashesPerSec = 0;

function updateStats() {
    const now = performance.now();
    let timeDiff = (now - lastTime)/1000;
    if(timeDiff < 0.1) return; // avoid divide by zero or tiny delta

    const genDiff = generation - lastGen;
    const hashesPerSec = genDiff / timeDiff;

    // smooth hashes/sec
    smoothedHashesPerSec = 0.8*smoothedHashesPerSec + 0.2*hashesPerSec;

    // CPU usage estimate
    const cpuUsage = Math.min(100, (smoothedHashesPerSec / 5000) * 100);
    document.getElementById('cpuUsage').textContent = cpuUsage.toFixed(1) + '%';

    // GPU activity estimate
    document.getElementById('gpuUsage').textContent = (smoothedHashesPerSec/1000).toFixed(1) + 'k hashes/sec';

    // RAM usage (Chrome only)
    if(performance.memory){
        document.getElementById('ramUsed').textContent = (performance.memory.usedJSHeapSize/1048576).toFixed(1);
    }

    // Estimated power
    const power = (cpuUsage*0.5 + (smoothedHashesPerSec/1000)*0.3).toFixed(1);
    document.getElementById('power').textContent = power + ' W';

    lastGen = generation;
    lastTime = now;
}

/*********** SHA-256 Mining ***********/
async function mineBatch(batchSize=50){
    for(let i=0;i<batchSize;i++){
        const data = new TextEncoder().encode(currentInput);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashHex = toHex(hashBuffer);

        generation++;
        if(!lowestHash || hashHex < lowestHash){
            lowestHash = hashHex;
            lowestInput = currentInput;
        }

        // Update mining info
        document.getElementById('generation').textContent = generation;
        document.getElementById('currentInput').textContent = currentInput;
        document.getElementById('currentHash').textContent = hashHex;
        document.getElementById('lowestHash').textContent = lowestHash;
        document.getElementById('lowestInput').textContent = lowestInput;

        currentInput = incrementString(currentInput);
    }
}

/*********** Main Loop ***********/
async function run(){
    while(true){
        await mineBatch(50);
        updateStats();
    }
}

run();
</script>

</body>
</html>
